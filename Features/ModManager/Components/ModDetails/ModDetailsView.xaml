<UserControl x:Class="RimSharp.Features.ModManager.Components.ModDetails.ModDetailsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:RimSharp.Features.ModManager.Components.ModDetails"
             xmlns:models="clr-namespace:RimSharp.Shared.Models"
             xmlns:vm="clr-namespace:RimSharp.Features.ModManager.ViewModels"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=vm:ModDetailsViewModel, IsDesignTimeCreatable=False}"
             d:DesignHeight="600" d:DesignWidth="450">
    <UserControl.Resources>
        <Style x:Key="InfoItemContainerStyle" TargetType="StackPanel">
            <Setter Property="Orientation" Value="Horizontal"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>
        <Style x:Key="InfoIconStyle" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="{StaticResource RimworldBrownBrush}"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Width" Value="16"/>
        </Style>
        <Style x:Key="InfoLabelStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{StaticResource RimworldDarkBrownBrush}"/>
            <Setter Property="Margin" Value="0,0,5,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        <Style x:Key="InfoValueStyle" TargetType="TextBlock">
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Foreground" Value="{StaticResource RimworldBrownBrush}"/>
        </Style>
        <Style x:Key="CodeBoxStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource RimworldBeigeBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource RimworldLightBrownBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="3"/>
            <Setter Property="Padding" Value="8"/>
        </Style>
    </UserControl.Resources>

    <Grid DataContext="{Binding CurrentMod}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Image Preview -->
            <RowDefinition Height="Auto"/> <!-- Main Info Section -->
            <RowDefinition Height="Auto"/> <!-- Separator and Description Header -->
            <RowDefinition Height="*"/>   <!-- SCROLLABLE Description Content -->
        </Grid.RowDefinitions>

        <!-- Mod Preview (Unchanged) -->
        <Border Grid.Row="0" Margin="10,10,10,0" HorizontalAlignment="Stretch" VerticalAlignment="Top">
            <Border Background="{StaticResource RimworldDarkBrownBrush}" CornerRadius="3" MaxWidth="560" MaxHeight="360">
                <Viewbox Stretch="Uniform">
                    <Grid Width="560" Height="308">
                        <Rectangle Fill="{StaticResource RimworldDarkBrownBrush}" />
                        <Image Source="{Binding PreviewImagePath, Converter={StaticResource ImagePathConverter}, TargetNullValue={x:Null}}" Stretch="Uniform"/>
                        <TextBlock Text="NO PREVIEW IMAGE" FontSize="18" Foreground="{StaticResource RimworldLightBrownBrush}" HorizontalAlignment="Center" VerticalAlignment="Center" FontStyle="Italic" Visibility="{Binding PreviewImagePath, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=InvertIfNull}"/>
                    </Grid>
                </Viewbox>
            </Border>
        </Border>
        
        <!-- NON-SCROLLING Info Section -->
        <StackPanel Grid.Row="1" Margin="10,10,10,0">
            <!-- Main Info Grid - Reverted to a Grid for stable columns -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Left Column -->
                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                    <StackPanel Style="{StaticResource InfoItemContainerStyle}"><TextBlock Text="" Style="{StaticResource InfoIconStyle}"/><TextBlock Text="Name:" Style="{StaticResource InfoLabelStyle}"/><TextBlock Text="{Binding Name}" Style="{StaticResource InfoValueStyle}" FontWeight="Bold" /></StackPanel>
                    <StackPanel Style="{StaticResource InfoItemContainerStyle}"><TextBlock Text="" Style="{StaticResource InfoIconStyle}"/><TextBlock Text="Authors:" Style="{StaticResource InfoLabelStyle}"/><TextBlock Text="{Binding Authors}" Style="{StaticResource InfoValueStyle}"/></StackPanel>
                    <StackPanel Style="{StaticResource InfoItemContainerStyle}"><TextBlock Text="" Style="{StaticResource InfoIconStyle}"/><TextBlock Text="Mod Type:" Style="{StaticResource InfoLabelStyle}"/><TextBlock Text="{Binding ModType, Converter={StaticResource ModTypeToDescriptionConverter}}" Style="{StaticResource InfoValueStyle}"/></StackPanel>
                    <StackPanel Style="{StaticResource InfoItemContainerStyle}" Visibility="{Binding Tags, Converter={StaticResource IsNotNullOrEmptyToVisibilityConverter}}"><TextBlock Text="" Style="{StaticResource InfoIconStyle}"/><TextBlock Text="Tags:" Style="{StaticResource InfoLabelStyle}"/><TextBlock Text="{Binding Tags}" Style="{StaticResource InfoValueStyle}"/></StackPanel>
                </StackPanel>
                
                <!-- Right Column -->
                <StackPanel Grid.Column="1" Margin="10,0,0,0">
                    <StackPanel Style="{StaticResource InfoItemContainerStyle}"><TextBlock Text="" Style="{StaticResource InfoIconStyle}"/><TextBlock Text="Content:" Style="{StaticResource InfoLabelStyle}"/><TextBlock Style="{StaticResource InfoValueStyle}" Text="{Binding Assemblies, Converter={StaticResource BooleanToTextConverter}, ConverterParameter='XML-Only|C# Code'}"/></StackPanel>
                    <StackPanel Style="{StaticResource InfoItemContainerStyle}"><TextBlock Text="" Style="{StaticResource InfoIconStyle}"/><TextBlock Text="Game Versions:" Style="{StaticResource InfoLabelStyle}"/><ContentControl Content="{Binding SupportedVersions, Converter={StaticResource VersionSupportConverter}}" VerticalAlignment="Center"/></StackPanel>
                    <StackPanel Style="{StaticResource InfoItemContainerStyle}" Visibility="{Binding ModVersion, Converter={StaticResource IsNotNullOrEmptyToVisibilityConverter}}"><TextBlock Text="" Style="{StaticResource InfoIconStyle}"/><TextBlock Text="Mod Version:" Style="{StaticResource InfoLabelStyle}"/><TextBlock Text="{Binding ModVersion}" Style="{StaticResource InfoValueStyle}"/></StackPanel>
                </StackPanel>
            </Grid>
            
            <!-- Package/Path Section -->
            <Grid Margin="0,5,0,0">
                <Grid.ColumnDefinitions><ColumnDefinition Width="*"/><ColumnDefinition Width="*"/></Grid.ColumnDefinitions>
                <Border Grid.Column="0" Style="{StaticResource CodeBoxStyle}" Margin="0,0,5,0"><StackPanel><StackPanel Orientation="Horizontal" Margin="0,0,0,4"><TextBlock Text="" Style="{StaticResource InfoIconStyle}" Margin="0"/><TextBlock Text="Package ID" Style="{StaticResource InfoLabelStyle}"/></StackPanel><TextBox Text="{Binding PackageId}" FontFamily="Consolas" FontSize="11" IsReadOnly="True" BorderThickness="0" Background="Transparent" Foreground="{StaticResource RimworldBrownBrush}"/></StackPanel></Border>
                <Border Grid.Column="1" Style="{StaticResource CodeBoxStyle}" Margin="5,0,0,0"><StackPanel><StackPanel Orientation="Horizontal" Margin="0,0,0,4"><TextBlock Text="" Style="{StaticResource InfoIconStyle}" Margin="0"/><TextBlock Text="Path" Style="{StaticResource InfoLabelStyle}"/></StackPanel><TextBlock Style="{StaticResource InfoValueStyle}" FontSize="11"><Hyperlink Command="{Binding DataContext.OpenUrlCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding Path}" Style="{StaticResource RimworldHyperlinkStyle}"><TextBlock Text="{Binding Path}" TextTrimming="CharacterEllipsis" ToolTip="{Binding Path}"/></Hyperlink></TextBlock></StackPanel></Border>
            </Grid>
        </StackPanel>

        <!-- Separator and Description Header -->
        <StackPanel Grid.Row="2" Margin="10,15,10,0">
             <Separator Style="{StaticResource RimworldSeparatorStyle}" Margin="0,0,0,10"/>
             <TextBlock Text="Description" Style="{StaticResource InfoLabelStyle}" FontSize="16" Margin="0,0,0,5"/>
        </StackPanel>
        
        <!-- SCROLLABLE Description TextBox -->
        <TextBox Grid.Row="3" 
                 Text="{Binding Description, Mode=OneWay}"
                 Margin="10,0,10,10"
                 TextWrapping="Wrap"
                 IsReadOnly="True"
                 BorderThickness="0"
                 Background="Transparent"
                 Foreground="{StaticResource RimworldBrownBrush}"
                 VerticalScrollBarVisibility="Auto"
                 HorizontalScrollBarVisibility="Disabled"/>
    </Grid>
</UserControl>