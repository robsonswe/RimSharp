<UserControl x:Class="RimSharp.Features.ModManager.Views.ModsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:RimSharp.Features.ModManager.Views"
             xmlns:vm="clr-namespace:RimSharp.Features.ModManager.ViewModels"
             xmlns:modActions="clr-namespace:RimSharp.Features.ModManager.Components.ModActions"
             xmlns:modDetails="clr-namespace:RimSharp.Features.ModManager.Components.ModDetails"
             xmlns:modList="clr-namespace:RimSharp.Features.ModManager.Components.ModList"
             xmlns:models="clr-namespace:RimSharp.Shared.Models"
             xmlns:util="clr-namespace:RimSharp.Core.Helpers"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=vm:ModsViewModel, IsDesignTimeCreatable=False}"
             d:DesignHeight="600" d:DesignWidth="1000">
    <Grid>
        <!-- Loading Indicator -->
        <ProgressBar IsIndeterminate="True" Height="4" VerticalAlignment="Top" Panel.ZIndex="10" Margin="0"
                     Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                     Foreground="{StaticResource RimworldHighlightBrush}" Background="Transparent" BorderThickness="0"/>

        <!-- New 2-Row Layout -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Quick Actions Bar -->
                <RowDefinition Height="*"/>    <!-- Main Content (Details + Lists) -->
            </Grid.RowDefinitions>

            <!-- Quick Actions Bar Row -->
            <Border Grid.Row="0" Margin="0,0,0,8" Style="{StaticResource RimworldPanelBorder}" Padding="6,4">
                <modActions:ModActionsView DataContext="{Binding ModActionsViewModel}"/>
            </Border>

            <!-- Main Content Row -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="450"/> <!-- Details Panel -->
                    <ColumnDefinition Width="*"/>   <!-- Lists Panel -->
                </Grid.ColumnDefinitions>

                <!-- Mod Details Panel -->
                <Border Grid.Column="0" Margin="0,0,8,0" Style="{StaticResource RimworldPanelBorder}">
                    <modDetails:ModDetailsView DataContext="{Binding ModDetailsViewModel}"/>
                </Border>

                <!-- Mod Lists Panel -->
                <Grid Grid.Column="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/> <!-- Inactive List -->
                        <ColumnDefinition Width="*"/> <!-- Active List -->
                    </Grid.ColumnDefinitions>

                    <!-- Inactive Mods List -->
                    <modList:ModListView Grid.Column="0"
                                          x:Name="InactiveModList"
                                          HeaderText="Inactive"
                                          ItemsSource="{Binding ModListViewModel.InactiveMods}"
                                          SelectedItem="{Binding SelectedMod, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                          util:ListBoxSelectionHelper.SelectedItems="{Binding SelectedItems, Mode=OneWayToSource}"
                                          ItemCount="{Binding ModListViewModel.TotalInactiveMods, Mode=OneWay}"
                                          SearchText="{Binding ModListViewModel.InactiveSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                          FilterCommand="{Binding ModListViewModel.FilterInactiveCommand}"
                                          DoubleClickCommand="{Binding ModListViewModel.ActivateModCommand}"
                                          GroupName="Inactive"
                                          SelectedItems="{Binding SelectedItems, Mode=TwoWay}"
                                          DropCommand="{Binding ModListViewModel.DropModCommand}"
                                          DragItemType="{x:Type models:ModItem}"
                                          Margin="0,0,4,0"/>

                     <!-- Active Mods List -->
                     <modList:ModListView Grid.Column="1"
                                          x:Name="ActiveModList"
                                          HeaderText="Active"
                                          ItemsSource="{Binding ModListViewModel.ActiveMods}"
                                          SelectedItem="{Binding SelectedMod, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                          util:ListBoxSelectionHelper.SelectedItems="{Binding SelectedItems, Mode=OneWayToSource}"
                                          ItemCount="{Binding ModListViewModel.TotalActiveMods, Mode=OneWay}"
                                          SearchText="{Binding ModListViewModel.ActiveSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                          FilterCommand="{Binding ModListViewModel.FilterActiveCommand}"
                                          DoubleClickCommand="{Binding ModListViewModel.DeactivateModCommand}"
                                          GroupName="Active"
                                          SelectedItems="{Binding SelectedItems, Mode=TwoWay}"
                                          DropCommand="{Binding ModListViewModel.DropModCommand}"
                                          DragItemType="{x:Type models:ModItem}"
                                          Margin="4,0,0,0"/>
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</UserControl>