<Window x:Class="RimSharp.AppDir.MainPage.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:RimSharp.AppDir.MainPage"
        xmlns:vm="clr-namespace:RimSharp.AppDir.MainPage"
        mc:Ignorable="d"
        Title="RimSharp - RimWorld Mod Manager" Height="900" Width="1200"
        MinHeight="900" MinWidth="1200"
        Style="{StaticResource RimworldWindowStyle}">

    <Grid>
        <DockPanel Visibility="{Binding IsInitialLoading, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
            <!-- Compact Header Bar (Merged Settings and Tabs) -->
            <Border DockPanel.Dock="Top" Margin="8,8,8,0" Style="{StaticResource RimworldPanelBorder}" Background="{StaticResource RimworldDarkBeigeBrush}" Padding="12,4">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Left Side: App Title + Tabs -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="RimSharp" FontSize="22" FontWeight="Bold" Foreground="{StaticResource RimworldBrownBrush}" VerticalAlignment="Center" Margin="0,0,24,0"/>

                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Button Content="Mods"
                                    Command="{Binding SwitchTabCommand}" CommandParameter="Mods"
                                    Style="{StaticResource RimworldTabButtonStyle}"/>
                            <Button Content="Downloader"
                                    Command="{Binding SwitchTabCommand}" CommandParameter="Downloader"
                                    Style="{StaticResource RimworldTabButtonStyle}"/>
                            <Button Content="Git Mods"
                                    Command="{Binding SwitchTabCommand}" CommandParameter="GitMods"
                                    Style="{StaticResource RimworldTabButtonStyle}"/>
                            <Button Content="VRAM Analysis"
                                    Command="{Binding SwitchTabCommand}" CommandParameter="VRAM"
                                    Style="{StaticResource RimworldTabButtonStyle}"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Right Side: Info + Global Actions -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                        <!-- Game Version Badge -->
                        <Border Background="{StaticResource RimworldLightBrownBrush}" 
                                BorderBrush="{StaticResource RimworldBrownBrush}" 
                                BorderThickness="1" 
                                CornerRadius="3" 
                                Padding="12,4" 
                                Margin="0,0,12,0"
                                VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <!-- Status Ball Indicator -->
                                <Ellipse x:Name="StatusBall" 
                                         Width="8" Height="8" 
                                         Margin="0,0,8,0" 
                                         VerticalAlignment="Center">
                                    <Ellipse.Style>
                                        <Style TargetType="Ellipse">
                                            <Setter Property="Fill" Value="{StaticResource RimworldDarkGreenBrush}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsUpdateAvailable}" Value="True">
                                                    <Setter Property="Fill" Value="{StaticResource RimworldRedBrush}"/>
                                                    <DataTrigger.EnterActions>
                                                        <BeginStoryboard x:Name="BlinkStoryboard">
                                                            <Storyboard>
                                                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                                 From="1" To="0.3" Duration="0:0:0.8"
                                                                                 AutoReverse="True" RepeatBehavior="Forever"/>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </DataTrigger.EnterActions>
                                                    <DataTrigger.ExitActions>
                                                        <StopStoryboard BeginStoryboardName="BlinkStoryboard"/>
                                                    </DataTrigger.ExitActions>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Ellipse.Style>
                                    <Ellipse.ToolTip>
                                        <ToolTip Style="{StaticResource RimworldToolTip}">
                                            <StackPanel>
                                                <TextBlock Text="RimWorld Status" FontWeight="Bold"/>
                                                <TextBlock x:Name="TooltipMessage" Text="Game is up to date">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsUpdateAvailable}" Value="True">
                                                                    <Setter Property="Text" Value="{Binding UpdateTooltipText}"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </StackPanel>
                                        </ToolTip>
                                    </Ellipse.ToolTip>
                                </Ellipse>

                                <TextBlock Text="{Binding PathSettings.GameVersion, StringFormat='v\{0\}'}" 
                                           FontSize="12" 
                                           FontWeight="Bold" 
                                           Foreground="{StaticResource RimworldBrownBrush}"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>

                        <!-- Paths Dropdown -->
                        <Menu Background="Transparent" VerticalAlignment="Center" Margin="0,0,12,0">
                            <MenuItem Header="Paths" Style="{StaticResource RimworldDropDownButtonStyle}" Padding="12,4">
                                <MenuItem Header="Game Directory" IsEnabled="False" Foreground="{StaticResource RimworldLightBrownBrush}" FontWeight="Bold" Style="{StaticResource RimworldMenuItemStyle}"/>
                                <MenuItem Header="{Binding PathSettings.GamePath}" 
                                          ToolTip="Click to open folder"
                                          Command="{Binding OpenFolderCommand}" 
                                          CommandParameter="GamePath"
                                          Style="{StaticResource RimworldMenuItemStyle}"/>
                                <MenuItem Header="Change Game Path..." 
                                          Command="{Binding BrowsePathCommand}" 
                                          CommandParameter="GamePath"
                                          Style="{StaticResource RimworldMenuItemStyle}"/>

                                <Separator Style="{StaticResource RimworldSeparatorStyle}"/>

                                <MenuItem Header="Config Directory" IsEnabled="False" Foreground="{StaticResource RimworldLightBrownBrush}" FontWeight="Bold" Style="{StaticResource RimworldMenuItemStyle}"/>
                                <MenuItem Header="{Binding PathSettings.ConfigPath}" 
                                          ToolTip="Click to open folder"
                                          Command="{Binding OpenFolderCommand}" 
                                          CommandParameter="ConfigPath"
                                          Style="{StaticResource RimworldMenuItemStyle}"/>
                                <MenuItem Header="Change Config Path..." 
                                          Command="{Binding BrowsePathCommand}" 
                                          CommandParameter="ConfigPath"
                                          Style="{StaticResource RimworldMenuItemStyle}"/>
                            </MenuItem>
                        </Menu>

                        <!-- Refresh Action -->
                        <Button Command="{Binding RefreshCommand}" 
                                Style="{StaticResource RimworldButtonStyle}" 
                                Padding="12,4" 
                                Margin="0,0,8,0"
                                MinWidth="0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="↻" FontFamily="Segoe UI Symbol" Margin="0,0,8,0" VerticalAlignment="Center" FontSize="14"/>
                                <TextBlock Text="Refresh" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>

                        <!-- About Action -->
                        <Button Command="{Binding AboutCommand}" 
                                Style="{StaticResource RimworldButtonStyle}" 
                                Padding="12,4" 
                                MinWidth="0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ℹ" FontFamily="Segoe UI Symbol" Margin="0,0,8,0" VerticalAlignment="Center" FontSize="14"/>
                                <TextBlock Text="About" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Main Content Area -->
            <Border Margin="8" Style="{StaticResource RimworldPanelBorder}" Background="{StaticResource RimworldBeigeBrush}">
                <ContentControl Content="{Binding CurrentViewModel}" />
            </Border>
        </DockPanel>

        

                <!-- Initial Loading Overlay -->

        

                <Grid Visibility="{Binding IsInitialLoading, Converter={StaticResource BooleanToVisibilityConverter}}">

        

                    <!-- Dimmed Background -->

        

                    <Border Background="#99000000"/>

        

            

        

                    <!-- Loading Card -->

        

                    <Border Style="{StaticResource RimworldPanelBorder}" 

        

                            Width="450" 

        

                            VerticalAlignment="Center" 

        

                            HorizontalAlignment="Center"

        

                            Padding="30"

        

                            BorderThickness="2"

        

                            CornerRadius="5">

        

                        <StackPanel>

        

                            <!-- App Icon -->

        

                            <Image Source="/icon.ico" Width="64" Height="64" RenderOptions.BitmapScalingMode="HighQuality" Margin="0,0,0,15"/>

        

                            

        

                            <!-- Title -->

        

                            <TextBlock Text="RimSharp" 

        

                                       FontSize="36" 

        

                                       FontWeight="Bold" 

        

                                       Foreground="{StaticResource RimworldBrownBrush}" 

        

                                       HorizontalAlignment="Center" 

        

                                       Margin="0,0,0,2"/>

        

                            

        

                                                        <!-- Subtitle -->
                                                        <TextBlock Text="RimWorld Mod Manager" 
                                                                   FontSize="16" 
                                                                   Foreground="{StaticResource RimworldLightBrownBrush}" 
                                                                   HorizontalAlignment="Center" 
                                                                   Margin="0,0,0,2"
                                                                   FontStyle="Italic"/>
                            
                                                        <!-- App Version -->
                                                        <TextBlock Text="{Binding AppVersion}" 
                                                                   FontSize="12" 
                                                                   Foreground="{StaticResource RimworldLightBrownBrush}" 
                                                                   HorizontalAlignment="Center" 
                                                                   Margin="0,0,0,25"
                                                                   FontStyle="Italic"/>

        

            

        

                            <!-- Custom Progress Bar -->

        

                            <ProgressBar IsIndeterminate="{Binding IsAppLoading}" 

        

                                         Style="{StaticResource RimworldProgressBarStyle}"

        

                                         Height="10" 

        

                                         Margin="0,0,0,15"/>

        

            

        

                            <!-- Status Text -->

        

                            <TextBlock Text="{Binding ModsVM.LoadingMessage}" 

        

                                       FontSize="14" 

        

                                       Foreground="{StaticResource RimworldDarkBrownBrush}" 

        

                                       HorizontalAlignment="Center"

        

                                       TextAlignment="Center"

        

                                       TextTrimming="CharacterEllipsis"

        

                                       MaxWidth="380"/>

        

                        </StackPanel>

        

                    </Border>

        

                </Grid>

        

            </Grid>

        

            

        </Window>

        