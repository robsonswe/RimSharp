<UserControl x:Class="RimSharp.Views.Modules.Mods.ModsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:RimSharp.Views.Modules.Mods"
             xmlns:vm="clr-namespace:RimSharp.ViewModels.Modules.Mods"
             xmlns:controls="clr-namespace:RimSharp.Views.Modules.Mods.Controls"
             xmlns:models="clr-namespace:RimSharp.Models"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=vm:ModsViewModel, IsDesignTimeCreatable=True}"
             d:DesignHeight="600" d:DesignWidth="1000">
    <Grid>
        <!-- Loading Indicator -->
        <ProgressBar IsIndeterminate="True" Height="4" VerticalAlignment="Top" Panel.ZIndex="10" Margin="0"
                     Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                     Foreground="{StaticResource RimworldHighlightBrush}" Background="Transparent" BorderThickness="0"/>

        <!-- Main 3-Column Layout -->
        <Grid Margin="0,5,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2.25*"/> <!-- Details Panel -->
                <ColumnDefinition Width="2*"/>   <!-- Lists Panel -->
                <ColumnDefinition Width="Auto"/>  <!-- Buttons Panel -->
            </Grid.ColumnDefinitions>

            <!-- Mod Details Panel -->
            <Border Grid.Column="0" Margin="0,0,8,0" Style="{StaticResource RimworldPanelBorder}">
                <!-- Use the ModDetailsView control -->
                <!-- Its DataContext needs to be the SelectedMod from the main ViewModel -->
                 <controls:ModDetailsView DataContext="{Binding SelectedMod}"/>
                 <!-- The Hyperlink command inside ModDetailsView uses RelativeSource to find the main VM's command -->
            </Border>

            <!-- Mod Lists Panel -->
            <Grid Grid.Column="1" Margin="0,0,8,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/> <!-- Inactive List -->
                    <ColumnDefinition Width="Auto"/> <!-- Separator (Optional) -->
                    <ColumnDefinition Width="*"/> <!-- Active List -->
                </Grid.ColumnDefinitions>

                <!-- Inactive Mods List -->
                <controls:ModListView Grid.Column="0"
                                      HeaderText="Inactive"
                                      ItemsSource="{Binding InactiveMods}"
                                      SelectedItem="{Binding SelectedMod, Mode=TwoWay}"
                                      ItemCount="{Binding TotalInactiveMods, Mode=OneWay}"
                                      SearchText="{Binding InactiveSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                      FilterCommand="{Binding FilterInactiveCommand}"
                                      DoubleClickCommand="{Binding ActivateModCommand}"
                                      GroupName="Inactive"
                                      DropCommand="{Binding DropModCommand}"
                                      DragItemType="{x:Type models:ModItem}"
                                      Margin="0,0,4,0"/>

                 <!-- Active Mods List -->
                 <controls:ModListView Grid.Column="2"
                                      HeaderText="Active"
                                      ItemsSource="{Binding ActiveMods}"
                                      SelectedItem="{Binding SelectedMod, Mode=TwoWay}"
                                      ItemCount="{Binding TotalActiveMods, Mode=OneWay}"
                                      SearchText="{Binding ActiveSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                      FilterCommand="{Binding FilterActiveCommand}"
                                      DoubleClickCommand="{Binding DeactivateModCommand}"
                                      GroupName="Active"
                                      DropCommand="{Binding DropModCommand}"
                                      DragItemType="{x:Type models:ModItem}"
                                      Margin="4,0,0,0"/>
            </Grid>

            <!-- Right Sidebar Buttons -->
            <controls:ModActionsView Grid.Column="2" Margin="8,0,0,0"/>
             <!-- DataContext is inherited from parent (ModsViewModel) -->

        </Grid>
    </Grid>
</UserControl>
